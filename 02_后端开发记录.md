后端地址 https://github.com/haruki1953/e5share_node.git

[参考：nodejs05_项目](../240117nodejsNote/05_项目.md)

# 一、初始化项目
## 1.1 创建项目
新建 e5share_node 文件夹作为项目根目录  
安装 express ：pnpm add express

创建 git 版本库，将 node_modules 文件夹加入忽略文件  

安装配置ESLint [node项目中使用ESLint](笔记/node项目中使用ESLint.md)

在项目根目录中新建 app.js 作为整个项目的入口文件，初始化一个基本的服务器  
```js
// 导入 express 模块
const express = require('express');
// 创建 express 的服务器实例
const app = express();

// write your code here...

// 调用 app.listen 方法，指定端口号并启动web服务器
app.listen(3007, () => {
  console.log('api server running at http://127.0.0.1:3007');
});
```
使用 nodemon app.js 来启动项目

## 1.2 配置 cors 跨域
运行如下的命令，安装 cors 中间件：pnpm add cors@2.8.5  
在 app.js 中导入并配置 cors 中间件：
```js
// 导入 cors 中间件
const cors = require('cors');
// 将 cors 注册为全局中间件
app.use(cors());
```

## 1.3 配置解析表单数据的中间件
```js
// 解析 JSON 格式的请求体数据
app.use(express.json());
```

## 1.4 初始化路由相关的文件夹
新建 /router 文件夹，用来存放所有的 路由 模块  
新建 /router_handler 文件夹，用来存放所有的 路由处理函数模块  

基本路由目录结构规划：
```
e5share_node/
├── router/
│   ├── authRouter.js              // 登录注册相关路由
│   ├── userRouter.js              // 用户相关路由
│   ├── publicRouter.js            // 公共接口路由
│   ├── postRouter.js              // e5动态相关路由
│   └── shareRouter.js             // e5分享相关路由
└── router_handler/
    ├── authHandler.js             // 登录注册相关路由处理函数
    ├── userHandler.js             // 用户相关路由处理函数
    ├── publicHandler.js           // 公共接口路由处理函数
    ├── postHandler.js             // e5动态相关路由处理函数
    └── shareHandler.js            // e5分享相关路由处理函数
```

## 1.5 初始化 auth 登录注册相关路由
/router/authRouter.js 文件，作为登录注册相关路由模块  
/router_handler/authHandler.js 文件，其中保存路由处理函数  


# 二、数据库创建与配置
创建文件夹 /db，用来存放sqlite数据库

安装Sequelize和SQLite：pnpm add sequelize sqlite3  
注意：好像因为缺少编译工具会报错，需要设置代理，以不在本地编译
```
pnpm config set proxy http://localhost:10809
pnpm config set https-proxy http://localhost:10809
```
当你运行`npm install sqlite3`命令时，npm会首先尝试从远程服务器下载预编译的二进制包。如果这个过程成功，那么就不需要在本地进行编译。然而，如果由于网络问题或者其他原因导致下载失败，npm会尝试在本地编译这些插件。

在项目中使用Sequelize
```
/
|-- db/
|   |-- index.js             // 创建 Sequelize 实例并连接数据库，导出
|   |-- initialize.js        // 定义初始化函数并导出
|   `-- database.sqlite      // SQLite 数据库文件
|-- models/
|   |-- index.js             // 导入并导出所有模型，方便使用
|   |-- user.js              // 定义 User 模型并导出
|   |-- user_notification.js // 定义 UserNotification 模型并导出
|   `-- user_e5_post.js      // 定义 UserE5Post 模型并导出
`-- app.js                   // 引入初始化函数并启动服务器前进行数据库初始化
```


## 三、注册登录

注册