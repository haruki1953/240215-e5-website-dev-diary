项目名 e5share-web-mobile
使用 TypeScript
使用 Vant4 https://vant-contrib.gitee.io/vant/#/zh-CN

项目地址 https://github.com/haruki1953/e5share-web-mobile.git

参考：
	[04_前端开发记录](04_前端开发记录.md)
	[day08-day10-智慧商城项目](../240207vueNote/day08-day10-智慧商城项目.md)


# 一、初始化项目
## 1.1 pnpm 创建项目
创建项目：pnpm create vue  
![](assets/Pasted%20image%2020240430134542.png)
- 安装依赖：pnpm install
- 运行项目：pnpm dev

## 1.2 ESLint & prettier 配置代码风格
[【04_前端开发记录】1.2 ESLint & prettier 配置代码风格](04_前端开发记录.md#1.2%20ESLint%20&%20prettier%20配置代码风格)

ts可能有区别，但大致是一样的

## 1.3 基于 husky 的代码检查工作流
[【04_前端开发记录】1.3 基于 husky 的代码检查工作流](04_前端开发记录.md#1.3%20基于%20husky%20的代码检查工作流)

## 1.4 调整项目目录
[【04_前端开发记录】1.4 调整项目目录](04_前端开发记录.md#1.4%20调整项目目录)

注意
```vue
<script setup lang="ts"></script>
```


## 1.5 引入 Vant4 组件库
https://vant-contrib.gitee.io/vant/#/zh-CN/quickstart

安装 pnpm add vant@4.8.11

### 自动按需引入组件
#### 1. 安装插件
```
pnpm add @vant/auto-import-resolver unplugin-vue-components unplugin-auto-import -D
```

#### 2. 配置插件
在 `vite.config.js/ts` 文件中配置插件：
```ts
import vue from '@vitejs/plugin-vue';
import AutoImport from 'unplugin-auto-import/vite';
import Components from 'unplugin-vue-components/vite';
import { VantResolver } from '@vant/auto-import-resolver';

export default {
  plugins: [
    vue(),
    AutoImport({
      resolvers: [VantResolver()],
    }),
    Components({
      resolvers: [VantResolver()],
    }),
  ],
};
```

### 解决自动引入造成的变量类型未声明问题
以轻提示 showToast 为例，虽然已经自动引入，但在使用是会显示变量未定义。

#### 在 eslintrc.cjs 中声明全局变量名
```js
// eslintrc.cjs
module.exports = {
  ...
  globals: {
    showToast: 'readonly',
    showLoadingToast: 'readonly',
    showSuccessToast: 'readonly',
    showFailToast: 'readonly'
  }
}
```
对于js项目，这样就足够了。但是对于ts还不行，因为编译器无法得知类型

#### 在 tsconfig.app.json 中添加自动引入生成的类型声明文件
项目根目录下的 auto-imports.d.ts 与 components.d.ts 都是自动引入插件所生成的，其中包含了所使用的组件的类型信息。
需要手动将这两个类型声明文件，添加至 tsconfig.app.json 中的 include 数组内
```json
{
  // ...
  "include": [
    // ...
    "auto-imports.d.ts",
    "components.d.ts"
  ],
}
```
此时再使用 showToast() 就可以看见类型了，也不报错了


## 1.7 Pinia
[【04_前端开发记录】1.7 Pinia](04_前端开发记录.md#1.7%20Pinia)
注意新建文件时是ts
顺便创建好AuthStore

## 1.8 数据交互 - 请求工具设计
[【04_前端开发记录】1.8 数据交互 - 请求工具设计](04_前端开发记录.md#1.8%20数据交互%20-%20请求工具设计)

因为使用ts，做了一些小修改
使用vant的 showFailToast('失败文案'); 来提示错误
```ts
import axios from 'axios'
import { useAuthStore } from '@/stores'
import router from '@/router'

const baseURL = 'http://big-event-vue-api-t.itheima.net'

const instance = axios.create({
  // TODO 1. 基础地址，超时时间
  baseURL,
  timeout: 10000
})

// 请求拦截器
instance.interceptors.request.use(
  (config) => {
    // TODO 2. 携带token
    const useStore = useAuthStore()
    if (useStore.token) {
      config.headers.Authorization = useStore.token
    }
    return config
  },
  (err) => Promise.reject(err)
)

// 响应拦截器
instance.interceptors.response.use(
  (res) => {
    // TODO 4. 摘取核心响应数据
    if (res.data.code === 0) {
      return res
    }
    if (res.status === 204) {
      // 204 响应表示请求成功但无内容，不需要给出错误提示
      return res
    }
    // TODO 3. 处理业务失败
    // 处理业务失败, 给错误提示，抛出错误
    showFailToast(res.data.message || '服务异常')
    return Promise.reject(res.data)
  },
  (err) => {
    // TODO 5. 处理401错误
    // 错误的特殊情况 => 401 权限不足 或 token 过期 => 拦截到登录
    if (err.response?.status === 401) {
      router.push('/login')
    }

    // 错误的默认情况 => 只要给提示
    showFailToast(err.response?.data.message || '服务异常')
    return Promise.reject(err)
  }
)

export default instance
```


## 1.9 整体路由设计